(function(a){a.fn.makeEditable=function(B){var k=0;function f(ab){return c.fnGetRowID(a(ab.parentNode))}function E(ac,ad,ab){if(ab){ac.attr("id",ad)}else{if(ac.attr("id")==null||ac.attr("id")==""){ac.attr("id",ad)}}}function n(ab){return ab.attr("id")}function aa(ab,ac){a("td:first",ab).html(ac)}function H(ab){return a("td:first",ab).html()}var z;var h,x,Y,X;var j;var c;function g(ab,ac){alert(ab)}function T(){if(z.fnSettings().oFeatures.bProcessing){a(".dataTables_processing").css("visibility","visible")}}function S(){if(z.fnSettings().oFeatures.bProcessing){a(".dataTables_processing").css("visibility","hidden")}}var J,y,o;function M(ah){if(c.bDisableEditing){return}var ag={event:"dblclick",onsubmit:function(an,al){J=al.revert;y=null;sNewCellDisplayValue=null;k=b();if(an.type=="text"||an.type=="select"||an.type=="textarea"){var ak=a("input,select,textarea",this);y=a("input,select,textarea",a(this)).val();if(ak.length==1){var am=ak[0];if(am.nodeName.toLowerCase()=="select"||am.tagName.toLowerCase()=="select"){sNewCellDisplayValue=a("option:selected",am).text()}else{sNewCellDisplayValue=y}}if(!c.fnOnEditing(ak,an,al.revert,f(al))){return false}var aj=an;if(an.oValidationOptions!=null){ak.parents("form").validate(an.oValidationOptions)}if(an.cssclass!=null){ak.addClass(an.cssclass)}if(an.cssclass==null&&an.oValidationOptions==null){return true}else{if(!ak.valid()||0==ak.valid()){return false}else{return true}}}c.fnStartProcessingMode()},submitdata:function(an,al){var aq=f(this);var ap=z.fnGetPosition(this)[0];var ao=z.fnGetPosition(this)[1];var am=z.fnGetPosition(this)[2];var ak=z.fnSettings().aoColumns[am].sName;if(ak==null||ak==""){ak=z.fnSettings().aoColumns[am].sTitle}var aj=null;if(c.aoColumns==null||c.aoColumns[am]==null){aj=a.extend({},c.oUpdateParameters,{id:aq,rowId:ap,columnPosition:ao,columnId:am,columnName:ak})}else{aj=a.extend({},c.oUpdateParameters,c.aoColumns[am].oUpdateParameters,{id:aq,rowId:ap,columnPosition:ao,columnId:am,columnName:ak})}return aj},callback:function(ao,al){c.fnEndProcessingMode();var ak="";var aj=z.fnGetPosition(this);var an=!N.oFeatures.bServerSide;a("td.last-updated-cell",z.fnGetNodes()).removeClass("last-updated-cell");if(ao.indexOf(c.sFailureResponsePrefix)>-1){z.fnUpdate(J,aj[0],aj[2],an);a("td.last-updated-cell",z).removeClass("last-updated-cell");a(this).addClass("last-updated-cell");c.fnShowError(ao.replace(c.sFailureResponsePrefix,"").trim(),"update");ak="failure"}else{if(c.sSuccessResponse=="IGNORE"||(c.aoColumns!=null&&c.aoColumns[aj[2]]!=null&&c.aoColumns[aj[2]].sSuccessResponse=="IGNORE")||(y==null)||(y==ao)||c.sSuccessResponse==ao){if(sNewCellDisplayValue==null){z.fnUpdate(ao,aj[0],aj[2],an)}else{z.fnUpdate(sNewCellDisplayValue,aj[0],aj[2],an)}a("td.last-updated-cell",z).removeClass("last-updated-cell");a(this).addClass("last-updated-cell");ak="success"}else{z.fnUpdate(J,aj[0],aj[2],an);c.fnShowError(ao,"update");ak="failure"}}c.fnOnEdited(ak,J,sNewCellDisplayValue,aj[0],aj[1],aj[2]);if(al.fnOnCellUpdated!=null){al.fnOnCellUpdated(ak,ao,aj[0],aj[2],al)}r();if(c.bUseKeyTable){var am=z.keys;setTimeout(function(){am.block=false},0)}},onerror:function(){c.fnEndProcessingMode();c.fnShowError("Cell cannot be updated","update");c.fnOnEdited("failure")},onreset:function(){if(c.bUseKeyTable){var aj=z.keys;setTimeout(function(){aj.block=false},0)}},height:c.sEditorHeight,width:c.sEditorWidth};var ac=null;if(c.aoColumns!=null){for(var af=0,ai=0;af<N.aoColumns.length;af++){if(N.aoColumns[af].bVisible){if(c.aoColumns[ai]==null){ai++;continue}ac=a("td:nth-child("+(ai+1)+")",ah);var ae=ag;ae=a.extend({},ag,c.oEditableSettings,c.aoColumns[ai]);ai++;var ab=c.sUpdateURL;try{if(ae.sUpdateURL!=null){ab=ae.sUpdateURL}}catch(ad){}ac.each(function(){if(!a(this).hasClass(c.sReadOnlyCellClass)){a(this).editable(ab,ae)}})}}}else{ac=a("td:not(."+c.sReadOnlyCellClass+")",ah);ac.editable(c.sUpdateURL,a.extend({},ag,c.oEditableSettings))}}function l(ab){if(c.fnOnAdding()){if(j.valid()){k=b();c.fnStartProcessingMode();if(c.bUseFormsPlugin){a(j).ajaxSubmit({dataType:"xml",success:function(ad,ae,af){if(af.responseText.toLowerCase().indexOf("error")!=-1){c.fnEndProcessingMode();c.fnShowError(af.responseText.replace("Error",""),"add");c.fnOnAdded("failure")}else{e(af.responseText)}},error:function(ad){c.fnEndProcessingMode();c.fnShowError(ad.responseText,"add");c.fnOnAdded("failure")}})}else{var ac=j.serialize();a.ajax({url:c.sAddURL,data:ac,type:c.sAddHttpMethod,dataType:c.sAddDataType,success:e,error:function(ad){c.fnEndProcessingMode();c.fnShowError(ad.responseText,"add");c.fnOnAdded("failure")}})}}}ab.stopPropagation();ab.preventDefault()}function s(ab){return true}function e(af){c.fnEndProcessingMode();if(c.fnOnNewRowPosted(af)){var ag=z.fnSettings();if(!ag.oFeatures.bServerSide){jQuery.data(j,"DT_RowId",af);var ab=d(j);var ae;if(ag.aoColumns!=null&&isNaN(parseInt(ag.aoColumns[0].mDataProp))){ae=z.fnAddData(rowData)}else{ae=z.fnAddData(ab)}var ac=z.fnGetNodes(ae);c.fnSetRowID(a(ac),af,true);M(ac);a("tr.last-added-row",z).removeClass("last-added-row");a(ac).addClass("last-added-row")}j.dialog("close");a(j)[0].reset();a(".error",a(j)).html("");r();c.fnOnAdded("success");if(c.bUseKeyTable){var ad=z.keys;setTimeout(function(){ad.block=false},0)}}}function O(ab){a(j).validate().resetForm();a(j)[0].reset();a(".error",a(j)).html("");a(".error",a(j)).hide();j.dialog("close");ab.stopPropagation();ab.preventDefault()}function V(){if(c.bUseKeyTable){return}if(c.oDeleteRowButtonOptions!=null){x.button("option","disabled",true)}else{x.attr("disabled","true")}}function m(){if(c.oDeleteRowButtonOptions!=null){x.button("option","disabled",false)}else{x.removeAttr("disabled")}}var W,K;var p;function q(ac){var ab=a(this).attr("href");if(ab==null||ab==""){ab=c.sDeleteURL}ac.preventDefault();ac.stopPropagation();k=b();K=(a(this).parents("td"))[0];jSelectedRow=(a(this).parents("tr"));W=jSelectedRow[0];jSelectedRow.addClass(c.sSelectedRowClass);var ad=f(K);if(c.fnOnDeleting(jSelectedRow,ad,v)){v(ad,ab)}}function C(ac){ac.preventDefault();ac.stopPropagation();k=b();W=null;K=null;if(!c.bUseKeyTable){if(a("tr."+c.sSelectedRowClass+" td",z).length==0){_fnDisableDeleteButton();return}K=a("tr."+c.sSelectedRowClass+" td",z)[0]}else{K=a("td.focus",z)[0]}if(K==null){V();return}if(c.bUseKeyTable){p=z.keys.fnGetCurrentPosition()}var ad=f(K);var ab=a(K).parent("tr");W=ab[0];if(c.fnOnDeleting(ab,ad,v)){v(ad)}}function Z(ac,ad,ab){return confirm("Are you sure that you want to delete this record?")}function v(ae,ab){var ad=ab;if(ab==null){ad=c.sDeleteURL}c.fnStartProcessingMode();var ac=a.extend(c.oDeleteParameters,{id:ae});a.ajax({url:ad,type:c.sDeleteHttpMethod,data:ac,success:A,dataType:c.sDeleteDataType,error:function(af){c.fnEndProcessingMode();c.fnShowError(af.responseText,"delete");c.fnOnDeleted("failure")}})}function A(ab){c.fnEndProcessingMode();var ac=W;if(ab==c.sSuccessResponse||ab==""){z.fnDeleteRow(ac);V();r();if(c.bUseKeyTable){z.keys.fnSetPosition(p[0],p[1])}c.fnOnDeleted("success")}else{c.fnShowError(ab,"delete");c.fnOnDeleted("failure")}}function G(ab){}function t(ab){return true}function U(ab,ad,ag,af,ac,ae){}function F(){return true}function w(ab){}var N;function b(){return N._iDisplayStart}function r(){N._iDisplayStart=k;N.oApi._fnCalculateEnd(N);N.oApi._fnDraw(N)}function P(ab){return true}function u(ab){}function D(ab){if(c.aoTableAction){c.fnShowError("Configuration error - aoTableAction setting are not set",ab)}var ac=0;for(ac=0;ac<c.aoTableActions.length;ac++){if(c.aoTableActions[ac].sAction==ab){return c.aoTableActions[ac]}}c.fnShowError("Cannot find action configuration settings",ab)}function I(af,ac){var ae=z.fnGetPosition(ac);var ag=c.fnGetRowID(a(ac));a(af).validate().resetForm();jQuery.data(a(af)[0],"DT_RowId",ag);a("input.DT_RowId",a(af)).val(ag);jQuery.data(a(af)[0],"ROWID",ae);a("input.ROWID",a(af)).val(ae);var ad=z.fnSettings();var ab=ad.aoColumns.length;a("input:text[rel],input:radio[rel][checked],input:hidden[rel],select[rel],textarea[rel],input:checkbox[rel]",a(af)).each(function(){var ah=a(this).attr("rel");if(ah>=ab){c.fnShowError("In the form is placed input element with the name '"+a(this).attr("name")+"' with the 'rel' attribute that must be less than a column count - "+ab,"action")}else{var ai=z.fnGetData(ac)[ah];if(this.nodeName.toLowerCase()=="select"||this.tagName.toLowerCase()=="select"){if(this.multiple==true){var aj=new Array();aoCellValues=ai.split(",");for(i=0;i<=this.options.length-1;i++){if(jQuery.inArray(this.options[i].text.toLowerCase().trim(),aoCellValues)!=-1){aj.push(this.options[i].value)}}a(this).val(aj)}else{for(i=0;i<=this.options.length-1;i++){if(this.options[i].text.toLowerCase()==ai.toLowerCase()){a(this).val(this.options[i].value)}}}}else{if(this.nodeName.toLowerCase()=="span"||this.tagName.toLowerCase()=="span"){a(this).html(ai)}else{if(this.type=="checkbox"){if(ai=="true"){a(this).attr("checked",true)}}else{if(this.type=="radio"){if(this.value==ai){this.checked=true}}else{this.value=ai}}}}}})}function d(af){var ad=jQuery.data(af,"DT_RowId");var ac=N.aoColumns.length;var ab=new Array();var ae=new Object();a("input:text[rel],input:radio[rel][checked],input:hidden[rel],select[rel],textarea[rel],span.datafield[rel],input:checkbox[rel]",af).each(function(){var ag=a(this).attr("rel");var ah="";if(ag>=ac){c.fnShowError("In the add form is placed input element with the name '"+a(this).attr("name")+"' with the 'rel' attribute that must be less than a column count - "+ac,"add")}else{if(this.nodeName.toLowerCase()=="select"||this.tagName.toLowerCase()=="select"){ah=a.map(a.makeArray(a("option:selected",this)),function(aj,ai){return a(aj).text()}).join(",")}else{if(this.nodeName.toLowerCase()=="span"||this.tagName.toLowerCase()=="span"){ah=a(this).html()}else{if(this.type=="checkbox"){if(this.checked){ah=(this.value!="on")?this.value:"true"}else{ah=(this.value!="on")?"":"false"}}else{ah=this.value}}}ah=ah.replace("DATAROWID",ad);ah=ah.replace(c.sIDToken,ad);if(N.aoColumns!=null&&N.aoColumns[ag]!=null&&isNaN(parseInt(N.aoColumns[0].mDataProp))){ae[N.aoColumns[ag].mDataProp]=ah}else{ab[ag]=ah}}});if(N.aoColumns!=null&&isNaN(parseInt(N.aoColumns[0].mDataProp))){return ae}else{return ab}}function Q(af){var ad=a(af);var ab=ad.attr("id");ab=ab.replace("form","");var ac=ad.attr("action");if(c.fnOnBeforeAction(ab)){if(ad.valid()){k=b();c.fnStartProcessingMode();if(c.bUseFormsPlugin){var ae={success:function(ai,aj,ak){c.fnEndProcessingMode();if(ai.toLowerCase().indexOf("error")!=-1||aj!="success"){c.fnShowError(ai,ab);c.fnOnActionCompleted("failure")}else{R(af);c.fnOnActionCompleted("success")}},error:function(ai){c.fnEndProcessingMode();c.fnShowError(ai.responseText,ab);c.fnOnActionCompleted("failure")}};var ag=D(ab);ae=a.extend({},c.oAjaxSubmitOptions,ae);a(oActionForm).ajaxSubmit(ae)}else{var ah=ad.serialize();a.ajax({url:ac,data:ah,type:c.sAddHttpMethod,dataType:c.sAddDataType,success:function(ai){c.fnEndProcessingMode();R(af);c.fnOnActionCompleted("success")},error:function(ai){c.fnEndProcessingMode();c.fnShowError(ai.responseText,ab);c.fnOnActionCompleted("failure")}})}}}}function R(ad){var ac=d(ad);var ag=jQuery.data(ad,"ROWID");var af=z.fnSettings();var ae=af.aoColumns.length;for(var ab=0;ab<ae;ab++){if(af.aoColumns!=null&&af.aoColumns[ab]!=null&&isNaN(parseInt(af.aoColumns[0].mDataProp))){sCellValue=rowData[af.aoColumns[ab].mDataProp]}else{sCellValue=ac[ab]}if(sCellValue!=undefined){z.fnUpdate(sCellValue,ag,ab)}}r();a(ad).dialog("close");return}z=this;var L={sUpdateURL:"UpdateData",sAddURL:"AddData",sDeleteURL:"DeleteData",sAddNewRowFormId:"formAddNewRow",oAddNewRowFormOptions:{autoOpen:false,modal:true},sAddNewRowButtonId:"btnAddNewRow",oAddNewRowButtonOptions:null,sAddNewRowOkButtonId:"btnAddNewRowOk",sAddNewRowCancelButtonId:"btnAddNewRowCancel",oAddNewRowOkButtonOptions:{label:"Ok"},oAddNewRowCancelButtonOptions:{label:"Cancel"},sDeleteRowButtonId:"btnDeleteRow",oDeleteRowButtonOptions:null,sSelectedRowClass:"row_selected",sReadOnlyCellClass:"read_only",sAddDeleteToolbarSelector:".add_delete_toolbar",fnShowError:g,fnStartProcessingMode:T,fnEndProcessingMode:S,aoColumns:null,fnOnDeleting:Z,fnOnDeleted:G,fnOnAdding:F,fnOnNewRowPosted:s,fnOnAdded:w,fnOnEditing:t,fnOnEdited:U,sAddHttpMethod:"POST",sAddDataType:"text",sDeleteHttpMethod:"POST",sDeleteDataType:"text",fnGetRowID:n,fnSetRowID:E,sEditorHeight:"100%",sEditorWidth:"100%",bDisableEditing:false,oDeleteParameters:{},oUpdateParameters:{},sIDToken:"DT_RowId",aoTableActions:null,fnOnBeforeAction:P,bUseFormsPlugin:false,fnOnActionCompleted:u,sSuccessResponse:"ok",sFailureResponsePrefix:"ERROR",oKeyTable:null};c=a.extend(L,B);N=z.fnSettings();c.bUseKeyTable=(c.oKeyTable!=null);return this.each(function(){var ae=z.dataTableSettings[0].sTableId;if(c.bUseKeyTable){var ao=new KeyTable({table:document.getElementById(ae),datatable:z});z.keys=ao;ao.event.action(null,null,function(ap){if(a(ap).hasClass(c.sReadOnlyCellClass)){return}ao.block=true;setTimeout(function(){a(ap).dblclick()},0)})}if(z.fnSettings().sAjaxSource!=null){z.fnSettings().aoDrawCallback.push({fn:function(){M(z.fnGetNodes());a(z.fnGetNodes()).each(function(){var ap=z.fnGetPosition(this);var aq=z.fnGetData(ap)[0];c.fnSetRowID(a(this),aq)})},sName:"fnApplyEditable"})}else{M(z.fnGetNodes())}j=a("#"+c.sAddNewRowFormId);if(j.length!=0){var ac=z.fnSettings();var an=ac.aoColumns.length;for(ai=0;ai<an;ai++){if(a("[rel="+ai+"]",j).length==0){c.fnShowError("In the form that is used for adding new records cannot be found an input element with rel="+ai+" that will be bound to the value in the column "+ai+". See http://code.google.com/p/jquery-datatables-editable/wiki/AddingNewRecords#Add_new_record_form for more details","init")}}if(c.oAddNewRowFormOptions!=null){c.oAddNewRowFormOptions.autoOpen=false}else{c.oAddNewRowFormOptions={autoOpen:false}}j.dialog(c.oAddNewRowFormOptions);h=a("#"+c.sAddNewRowButtonId);if(h.length!=0){if(h.data("add-event-attached")!="true"){h.click(function(){j.dialog("open")});h.data("add-event-attached","true")}}else{if(a(c.sAddDeleteToolbarSelector).length==0){throw"Cannot find a button with an id '"+c.sAddNewRowButtonId+"', or placeholder with an id '"+c.sAddDeleteToolbarSelector+"' that should be used for adding new row although form for adding new record is specified"}else{h=null}}if(j[0].nodeName.toLowerCase()=="form"){j.unbind("submit");j.submit(function(ap){l(ap);return false})}else{a("form",j[0]).unbind("submit");a("form",j[0]).submit(function(ap){l(ap);return false})}var ab=[];Y=a("#"+c.sAddNewRowOkButtonId,j);if(Y.length==0){if(c.oAddNewRowOkButtonOptions.text==null||c.oAddNewRowOkButtonOptions.text==""){c.oAddNewRowOkButtonOptions.text="Ok"}c.oAddNewRowOkButtonOptions.click=l;c.oAddNewRowOkButtonOptions.id=c.sAddNewRowOkButtonId;ab.push(c.oAddNewRowOkButtonOptions)}else{Y.click(l)}X=a("#"+c.sAddNewRowCancelButtonId);if(X.length==0){if(c.oAddNewRowCancelButtonOptions.text==null||c.oAddNewRowCancelButtonOptions.text==""){c.oAddNewRowCancelButtonOptions.text="Cancel"}c.oAddNewRowCancelButtonOptions.click=O;c.oAddNewRowCancelButtonOptions.id=c.sAddNewRowCancelButtonId;ab.push(c.oAddNewRowCancelButtonOptions)}else{X.click(O)}if(ab.length>0){j.dialog("option","buttons",ab)}Y=a("#"+c.sAddNewRowOkButtonId);X=a("#"+c.sAddNewRowCancelButtonId);if(c.oAddNewRowFormValidation!=null){j.validate(c.oAddNewRowFormValidation)}}else{j=null}x=a("#"+c.sDeleteRowButtonId);if(x.length!=0){if(x.data("delete-event-attached")!="true"){x.click(C);x.data("delete-event-attached","true")}}else{x=null}oAddDeleteToolbar=a(c.sAddDeleteToolbarSelector);if(oAddDeleteToolbar.length!=0){if(h==null&&c.sAddNewRowButtonId!=""&&j!=null){oAddDeleteToolbar.append("<button id='"+c.sAddNewRowButtonId+"' class='add_row'>Add</button>");h=a("#"+c.sAddNewRowButtonId);h.click(function(){j.dialog("open")})}if(x==null&&c.sDeleteRowButtonId!=""){oAddDeleteToolbar.append("<button id='"+c.sDeleteRowButtonId+"' class='delete_row'>Delete</button>");x=a("#"+c.sDeleteRowButtonId);x.click(C)}}if(x!=null){if(c.oDeleteRowButtonOptions!=null){x.button(c.oDeleteRowButtonOptions)}V()}if(h!=null){if(c.oAddNewRowButtonOptions!=null){h.button(c.oAddNewRowButtonOptions)}}if(Y!=null){if(c.oAddNewRowOkButtonOptions!=null){Y.button(c.oAddNewRowOkButtonOptions)}}if(X!=null){if(c.oAddNewRowCancelButtonOptions!=null){X.button(c.oAddNewRowCancelButtonOptions)}}a(".table-action-deletelink",z).live("click",q);if(!c.bUseKeyTable){a("tbody",z).click(function(ap){if(a(ap.target.parentNode).hasClass(c.sSelectedRowClass)){a(ap.target.parentNode).removeClass(c.sSelectedRowClass);if(x!=null){V()}}else{a(z.fnSettings().aoData).each(function(){a(this.nTr).removeClass(c.sSelectedRowClass)});a(ap.target.parentNode).addClass(c.sSelectedRowClass);if(x!=null){m()}}})}else{z.keys.event.focus(null,null,function(aq,ap,ar){})}if(c.aoTableActions!=null){for(var ai=0;ai<c.aoTableActions.length;ai++){var ah=a.extend({sType:"edit"},c.aoTableActions[ai]);var al=ah.sAction;var af=ah.sActionFormId;var aj=a("#form"+al);if(aj.length!=0){var ak={autoOpen:false,modal:true};ak=a.extend({},ah.oFormOptions,ak);aj.dialog(ak);aj.data("action-options",ah);var am=a(".table-action-"+al);if(am.length!=0){am.live("click",function(){var av=this.className;var au=av.split(/\s+/);var ar="";var ap="";for(ai=0;ai<au.length;ai++){if(au[ai].indexOf("table-action-")>-1){ap=au[ai].replace("table-action-","");ar="#form"+ap}}if(ar==""){c.fnShowError("Cannot find a form with an id "+ar+" that should be associated to the action - "+ap,ap)}var at=a(ar).data("action-options");if(at.sType=="edit"){var aq=(a(this).parents("tr"))[0];I(aj,aq)}a(aj).dialog("open")})}aj.submit(function(ap){Q(this);return false});var ad=new Array();var ag=a("#form"+al+"Cancel",aj);if(ag.length!=0){ad.push(ag);ag.click(function(){var ap=a(this).parents("form")[0];a(ap).validate().resetForm();a(ap)[0].reset();a(".error",a(ap)).html("");a(".error",a(ap)).hide();a(ap).dialog("close")})}a("button",aj).button()}}}})}})(jQuery);